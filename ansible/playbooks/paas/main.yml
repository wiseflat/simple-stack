---
- name: Configure the platform
  any_errors_fatal: true
  hosts: infrastructure
  gather_facts: true
  become: true
  vars:
    ansible_pull_url: https://github.com/wiseflat/simple-stack.git
  roles:
    - ansible-ufw
    - ansible-docker
    - ansible-unattendedUpgrades
    - ansible-pull
  tasks:
    - name: Install mandatories packages
      ansible.builtin.package:
        pkg:
          - python3-passlib
        state: present
        install_recommends: false
        lock_timeout: 120
      register: apt_status
      until: apt_status is success
      delay: 6
      retries: 10
